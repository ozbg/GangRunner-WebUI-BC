<!-- templates/index.html -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Gang Runner Web Interface</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional: Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            padding-top: 60px;
            font-size: 0.9rem; /* Base font size */
        }
        /* Container settings */
        .container {
            max-width: 1600px; /* Adjusted for better readability */
        }
        /* Form Section Styling */
        .form-section {
            background-color: #ffffff;
            padding: 15px; /* Reduced padding */
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        /* Summary, Orders, Skipped Sections */
        .summary-section, .orders-section, .skipped-section {
            margin-top: 15px; /* Reduced margin */
        }
        /* Table Responsiveness */
        .table-responsive {
            max-height: 500px;
            overflow-y: auto;
        }
        /* Custom Textarea */
        .custom-textarea {
            height: 400px; /* Maintained height */
            font-size: 0.75rem; /* Increased font size for better readability */
        }
        /* Button Styling */
        .btn-primary {
            font-size: 0.9rem;
            padding: 6px 12px; /* Reduced padding */
        }
        .btn-show-all {
            font-size: 0.75rem;
            padding: 4px 8px; /* Reduced padding */
            margin-top: 10px; /* Added margin for spacing */
        }
        /* Hide additional summary items by default */
        .additional-summary {
            display: none;
        }
        /* Custom Classes for Summary Titles and Values */
        .summary-title {
            font-size: 0.85rem; /* Further reduced font size for titles */
            font-weight: 500; /* Medium font weight */
        }
        .summary-value {
            font-size: 1.1rem; /* Slightly increased font size for values */
            font-weight: bold; /* Bold font weight */
        }
        /* Loading Spinner Styling within Button */
        #button-spinner {
            display: none; /* Hidden by default */
            margin-left: 5px; /* Spacing between text and spinner */
        }
        /* Main Headings */
        .main-heading {
            font-size: 1.3rem; /* Reduced size from 1.5rem */
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        /* Form Labels and Inputs */
        .form-label {
            font-size: 0.85rem; /* Reduced font size */
        }
        .form-control {
            font-size: 0.85rem; /* Reduced font size */
        }
        /* Table Headings and Data */
        .table thead th {
            font-size: 0.85rem; /* Reduced font size */
        }
        .table tbody td {
            font-size: 0.85rem; /* Reduced font size */
        }
        /* Summary Text Styling */
        .summary-item {
            margin-top: 10px;
            margin-bottom: 10px; /* Spacing between summary items */
            font-size: 1.15rem; /* Adjusted font size */
        }
        .summary-item span.label {
            font-weight: bold;
            font-size: 1rem; /* Adjusted font size */
        }
        /* Custom Dark Orange Color */
        .text-darkorange {
            color: #FF8C00; /* Dark Orange */
        }
    </style>
    <script>
        // Toggle Additional Summary Items
        function toggleAdditionalSummary() {
            var additionalSummary = document.getElementById('additional-summary');
            var toggleButton = document.getElementById('toggle-button');
            if (additionalSummary.style.display === 'none') {
                additionalSummary.style.display = 'block';
                toggleButton.textContent = 'Show Less';
            } else {
                additionalSummary.style.display = 'none';
                toggleButton.textContent = 'Show All';
            }
        }

        // Toggle Multiplier Div (If Mode Selection Exists in Future)
        function toggleMultiplier() {
            var mode = document.querySelector('input[name="mode"]:checked').value;
            var multiplierDiv = document.getElementById('multiplier-div');
            if (mode === '3') {
                multiplierDiv.style.display = 'block';
            } else {
                multiplierDiv.style.display = 'none';
            }
        }

        window.onload = function() {
            toggleMultiplier(); // Initialize on load
            var modes = document.getElementsByName('mode');
            for (var i = 0; i < modes.length; i++) {
                modes[i].addEventListener('change', toggleMultiplier);
            }

            // Handle Form Submission to Show Loading Spinner within Button
            const form = document.querySelector('form');
            const buttonSpinner = document.getElementById('button-spinner');
            const processButton = document.getElementById('process-button');

            form.addEventListener('submit', () => {
                // Disable the button to prevent multiple submissions
                processButton.disabled = true;
                // Show spinner inside the button
                buttonSpinner.style.display = 'inline-block';
            });
        }
    </script>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">Gang Runner</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" 
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Form Section -->
        <div class="form-section">
            <h2 class="main-heading mb-3">
                <i class="bi bi-gear-wide-connected" ></i> Optimize Your Gang Run
            </h2>
            <form method="POST" action="/process">
                <!-- Sheet Parameters -->
                <div class="mb-3">
                    <label class="form-label"><strong>Sheet Parameters:</strong></label>
                    <div class="row g-2">
                        <div class="col-md-4">
                            <label for="min_sheets" class="form-label">Minimum Sheets:</label>
                            <input type="number" class="form-control" name="min_sheets" id="min_sheets" min="1" value="{{ request.form.min_sheets if request.form.min_sheets else '245' }}" required>
                        </div>
                        <div class="col-md-4">
                            <label for="max_sheets" class="form-label">Maximum Sheets:</label>
                            <input type="number" class="form-control" name="max_sheets" id="max_sheets" min="1" value="{{ request.form.max_sheets if request.form.max_sheets else '500' }}" required>
                        </div>
                        <div class="col-md-4">
                            <label for="increment" class="form-label">Increment:</label>
                            <input type="number" class="form-control" name="increment" id="increment" min="1" value="{{ request.form.increment if request.form.increment else '5' }}" required>
                        </div>
                    </div>
                </div>

                <!-- Multiplier for Custom Priority Mode (Hidden as Mode 1 is default) -->
                <div class="mb-3" id="multiplier-div" style="display: none;">
                    <label for="custom_multiplier" class="form-label"><strong>Multiplier for Order Weight:</strong></label>
                    <input type="number" class="form-control" step="any" min="0.1" name="custom_multiplier" id="custom_multiplier" placeholder="e.g., 20" value="{{ request.form.custom_multiplier if request.form.custom_multiplier else '' }}">
                </div>

                <!-- Order Data Input -->
                <div class="mb-3">
                    <label for="input_text" class="form-label"><strong>Order Data:</strong></label>
                    <textarea class="form-control custom-textarea" name="input_text" id="input_text" placeholder="Paste your text data here..." required>{{ input_text | safe }}</textarea>
                </div>

                <!-- Submit Button with Spinner -->
                <button type="submit" class="btn btn-primary" id="process-button">
                    <i class="bi bi-arrow-right-circle"></i> Process
                    <span id="button-spinner" class="spinner-border spinner-border-sm text-light" role="status" aria-hidden="true"></span>
                </button>
            </form>
        </div>

        <!-- Error Alert -->
        {% if error %}
        <div class="alert alert-danger alert-dismissible fade show mt-3" role="alert">
            <strong>Error:</strong> {{ error }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endif %}

        <!-- Potential Run Section -->
        {% if summary %}
        <div class="summary-section">
            <h3 class="main-heading mb-3"><i class="bi bi-bar-chart-line"></i> Potential Run</h3>
            <div class="row">
                <!-- First Row -->
                <div class="col-md-3">
                    <div class="summary-item">
                        <span class="label">Number of Sheets:</span> <span class="text-primary">{{ summary['Number of Sheets'] }}</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="summary-item">
                        <span class="label">Empty Seats:</span>
                        {% if summary['Empty Seats']|int <= 10 %}
                            <span class="text-success">{{ summary['Empty Seats'] }}</span>
                        {% elif summary['Empty Seats']|int <= 20 %}
                            <span class="text-warning">{{ summary['Empty Seats'] }}</span>
                        {% else %}
                            <span class="text-danger">{{ summary['Empty Seats'] }}</span>
                        {% endif %}
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="summary-item">
                        <span class="label">Total Placed:</span> <span class="text-primary">{{ summary['Total Placed Objects'] }}</span>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="summary-item">
                        <span class="label">Total Unique:</span>
                        {% if summary['Total Unique Kinds']|int >= 61 %}
                            <span class="text-success">{{ summary['Total Unique Kinds'] }}</span>
                        {% elif summary['Total Unique Kinds']|int >= 50 %}
                            <span class="text-warning">{{ summary['Total Unique Kinds'] }}</span>
                        {% else %}
                            <span class="text-danger">{{ summary['Total Unique Kinds'] }}</span>
                        {% endif %}
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Second Row -->
                <div class="col-md-6">
                    <div class="summary-item">
                        <span class="label">GP Per Point:</span> <span class="text-success">{{ summary['GP Per Point'] }}</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="summary-item">
                        <span class="label">Gross Profit:</span> <span class="text-success">{{ summary['Gross Profit'] }}</span>
                    </div>
                </div>
            </div>

            <div class="row">
                <!-- Third Row -->
                <div class="col-md-6">
                    <div class="summary-item">
                        <span class="label">Total Run Value:</span> {{ summary['Total Run Value'] }}
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="summary-item">
                        <span class="label">Total Overs Cost:</span> <span class="text-danger">{{ summary['Total Overs Cost'] }}</span>
                    </div>
                </div>
            </div>

            <!-- Additional Summary Items (Hidden by Default) -->
            <div id="additional-summary" class="additional-summary">
                <div class="row">
                    <div class="col-md-6">
                        <div class="summary-item">
                            <span class="label">Total Courier Cost:</span> <span class="text-danger">{{ summary['Total Courier Cost'] }}</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="summary-item">
                            <span class="label">Total Plate Cost:</span> <span class="text-danger">{{ summary['Total Plate Cost'] }}</span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="summary-item">
                            <span class="label">Total Paper Cost:</span> <span class="text-danger">{{ summary['Total Paper Cost'] }}</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="summary-item">
                            <span class="label">Total Overhead Cost:</span> <span class="text-danger">{{ summary['Total Overhead Cost'] }}</span>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="summary-item">
                            <span class="label">Total Production Cost:</span> <span class="text-danger">{{ summary['Total Production Cost'] }}</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="summary-item">
                            <span class="label">Gross Profit:</span> <span class="text-success">{{ summary['Gross Profit'] }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Show All / Show Less Button -->
            <button id="toggle-button" type="button" class="btn btn-secondary btn-show-all" onclick="toggleAdditionalSummary()">Show All</button>
        </div>
        {% endif %}

        <!-- Planned Orders Section -->
        {% if orders %}
        <div class="orders-section">
            <h3 class="main-heading mb-3"><i class="bi bi-table"></i> Planned Orders</h3>
            <div class="table-responsive">
                <table class="table table-striped table-hover">
                    <thead class="table-dark">
                        <tr>
                            {% for key in orders[0].keys() %}
                            <th>{{ key }}</th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for order in orders %}
                        <tr>
                            {% for key, value in order.items() %}
                                {% if key == "Overs" %}
                                    {% if value > 0 %}
                                        <td class="text-danger">{{ value }}</td>
                                    {% elif value < 0 %}
                                        <td class="text-primary">{{ value }}</td>
                                    {% else %}
                                        <td>{{ value }}</td>
                                    {% endif %}
                                {% elif key in ["Value", "Gross Profit", "Total Run Value", "Total Overs Cost", "Total Courier Cost", "Total Plate Cost", "Total Paper Cost", "Total Overhead Cost", "Total Production Cost", "GP Per Point"] %}
                                    {% if "Profit" in key or "GP Per Point" in key %}
                                        <td class="text-success">{{ value }}</td>
                                    {% elif "Cost" in key %}
                                        <td class="text-danger">{{ value }}</td>
                                    {% else %}
                                        <td>{{ value }}</td>
                                    {% endif %}
                                {% else %}
                                    <td>{{ value }}</td>
                                {% endif %}
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}

        <!-- Skipped Lines Section -->
        {% if skipped_lines %}
        <div class="skipped-section">
            <h3 class="main-heading mb-3"><i class="bi bi-exclamation-triangle"></i> Skipped Lines</h3>
            <div class="table-responsive">
                <table class="table table-bordered table-striped">
                    <thead class="table-warning">
                        <tr>
                            <th>Line</th>
                            <th>Error</th>
                            <th>Content</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for line in skipped_lines %}
                        <tr>
                            <td>{{ line.Line }}</td>
                            <td>{{ line.Error }}</td>
                            <td>{{ line.Content }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Bootstrap 5 JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>